# DTW 孤立词语音识别系统 (Core Methods)

## 1\. 项目概述

本项目实现了一个基于 **MFCC 特征** 和 **DTW (动态时间规整)** 算法的孤立词语音识别系统。系统针对数字（0-9）及特定汉语拼音指令进行识别。为了克服传统 DTW 算法在实际录音环境下的鲁棒性问题，本项目在信号预处理、特征提取参数调优以及距离度量归一化方面进行了深度优化。

## 2\. 核心算法与流程 (Core Methodology)

整个识别流程遵循 `预处理 -> 特征提取 -> 模式匹配` 的标准管道。

### 2.1 信号预处理 (Signal Preprocessing)

为了消除环境噪音和录音设备差异，系统在提取特征前对原始音频进行了严格的清洗。

  * **统一采样率 (Resampling)**:
      * 所有输入音频（无论是模板还是测试样本）强制重采样至 **16000 Hz**。这是为了确保 DTW 算法在时间轴上的尺度一致性，防止因采样率不同导致的特征序列长度失配。
  * **带通滤波 (Bandpass Filtering)**:
      * 采用 4 阶 **Butterworth 带通滤波器**。
      * **通带范围**: `80Hz - 7500Hz`。
      * **目的**: 80Hz 下限有效保留了男声基频（避免像 300Hz 截止频率那样切掉部分元音特征），同时滤除工频干扰（50Hz/60Hz 交流电声）；7500Hz 上限滤除了高频电子嘶嘶声。
  * **噪音门与端点检测 (Noise Gate & VAD)**:
      * **RMS 能量检测**: 计算音频的均方根（RMS）能量，若低于阈值（0.001），则判定为无效录音，避免对纯噪音进行匹配。
      * **静音消除 (Silence Trimming)**: 使用 `librosa.effects.trim` (top\_db=30) 切除首尾静音段。配合前端的双向阈值裁剪算法，确保送入 DTW 的序列仅包含有效语音，防止静音段拉长导致匹配路径畸变。

### 2.2 特征提取 (Feature Extraction)

系统使用 **MFCC (梅尔频率倒谱系数)** 作为声学特征。针对短促的数字发音（如 "1", "7"），采用了高时间分辨率的参数配置。

  * **参数配置 (ASR Standard)**:
      * `n_mfcc`: **13** (保留主要共振峰信息，丢弃高阶细节)。
      * `n_fft`: **512**。
      * `win_length`: **400 samples (25ms)**。这是语音识别领域的黄金标准窗口长度，能包含约 2-3 个基音周期。
      * `hop_length`: **160 samples (10ms)**。相比默认的 512 (32ms) 步长，10ms 的帧移使特征图谱在时间轴上的密度增加，显著提升了对短时语音变化的捕捉能力。
      * `preemph_coef`: **0.97** (预加重，提升高频分量)。
  * **特征标准化 (CMVN)**:
      * 对提取的 MFCC 矩阵进行 **倒谱均值方差归一化 (Cepstral Mean and Variance Normalization)**。
      * 公式: $X' = \frac{X - \mu}{\sigma + \epsilon}$
      * **目的**: 消除信道效应（如麦克风频响差异）和说话人音量的影响，使特征关注频谱形状而非绝对能量值。

### 2.3 模式匹配 (Pattern Matching)

核心识别引擎基于 **DTW (Dynamic Time Warping)** 算法。

  * **距离计算**:
      * 采用 **欧式距离 (Euclidean Distance)** 计算特征向量之间的相似度。
      * 相比余弦距离，欧式距离在经过 CMVN 标准化后的特征空间中表现更为稳健。
  * **距离归一化 (Normalization)**:
      * 原始 DTW 距离是“累积距离”，这会导致长模板天然比短模板距离大（更难匹配）。
      * **改进**: 将累积距离除以路径总长度 ( $L_{template} + L_{input}$ )。
      * 公式: $D_{norm} = \frac{DTW(T, I)}{|T| + |I|}$
      * 这一步对于解决“长短样本不平衡”问题至关重要，直接将准确率从 20% 提升至 90% 以上。

## 3\. 实验验证脚本 (Verification Scripts)

本项目提供了一系列脚本用于验证算法有效性和参数合理性：

1.  **核心算法自检 (`verify.py`)**:

      * **功能**: 不依赖麦克风和网页，直接在本地 `dataset/` 上执行标准的 Train/Test 分割测试。
      * **用途**: 用于排查前端录音问题。如果此脚本准确率高但网页端低，则必然是前端采样或噪音问题。

2.  **消融实验 (`ablation.py`)**:

      * **功能**: 依次关闭 静音消除、预加重、CMVN、距离归一化 等模块，量化每个组件对准确率的贡献。
      * **结论**: 实验表明 **CMVN** 和 **距离归一化** 是对性能影响最大的两个关键组件。

3.  **对比实验 (`comparison.py`)**:

      * **功能**: 对比 Euclidean 和 Cosine 两种距离度量方法。
      * **用途**: 验证距离度量对不同特征分布的敏感性。

## 4\. 文件结构说明

```text
exp3/
├── src/
│   ├── config.py       # 全局参数配置 (16k采样, 25ms窗口等)
│   ├── features.py     # 特征提取核心 (含滤波、VAD、MFCC、CMVN)
│   ├── dtw_core.py     # DTW 算法实现 (含距离归一化)
│   └── data_utils.py   # 数据加载与分割工具
├── verify.py           # 本地算法验证脚本 (Train/Test 分割)
├── ablation.py         # 消融实验脚本
├── comparison.py       # 对比实验脚本
└── build_templates.py  # 模板构建工具
```